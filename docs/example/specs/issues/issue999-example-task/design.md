# ãƒã‚¸ãƒƒã‚¯ãƒªãƒ³ã‚¯èªè¨¼æ©Ÿèƒ½ è¨­è¨ˆæ–‡æ›¸

## æ¦‚è¦

ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ¬ã‚¹èªè¨¼ã‚’å®Ÿç¾ã™ã‚‹ãƒã‚¸ãƒƒã‚¯ãƒªãƒ³ã‚¯æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ­ã‚°ã‚¤ãƒ³ä½“é¨“ã‚’å‘ä¸Šã•ã›ã¾ã™ã€‚ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã«é€ä¿¡ã•ã‚Œã‚‹ä¸€æ™‚çš„ãªãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã“ã¨ã§ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›ãªã—ã«å®‰å…¨ãªèªè¨¼ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚æœ¬è¨­è¨ˆæ›¸ã§ã¯ã€è¦ä»¶å®šç¾©æ›¸ã§å®šç¾©ã•ã‚ŒãŸ3ã¤ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ï¼ˆãƒã‚¸ãƒƒã‚¯ãƒªãƒ³ã‚¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã€èªè¨¼å‡¦ç†ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é€šçŸ¥ï¼‰ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã®æŠ€è¡“çš„å®Ÿè£…ã‚’è©³ç´°ã«å®šç¾©ã—ã¾ã™ã€‚

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³

```mermaid
graph TB
    User[ãƒ¦ãƒ¼ã‚¶ãƒ¼] --> WebApp[Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³]
    WebApp --> AuthAPI[èªè¨¼API]
    AuthAPI --> TokenService[ãƒˆãƒ¼ã‚¯ãƒ³ã‚µãƒ¼ãƒ“ã‚¹]
    AuthAPI --> EmailService[ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚µãƒ¼ãƒ“ã‚¹]
    TokenService --> DB[(PostgreSQL)]
    TokenService --> Redis[(Redis Cache)]
    EmailService --> SendGrid[SendGrid API]
    
    AuthAPI --> SecurityService[ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚µãƒ¼ãƒ“ã‚¹]
    SecurityService --> DeviceDetector[ãƒ‡ãƒã‚¤ã‚¹æ¤œçŸ¥]
    SecurityService --> RateLimit[ãƒ¬ãƒ¼ãƒˆåˆ¶é™]
    
    subgraph èªè¨¼ãƒ•ãƒ­ãƒ¼
        TokenService
        SecurityService
        RateLimit
    end
```

### ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼å›³ï¼ˆDFDï¼‰

```mermaid
flowchart LR
    %% å¤–éƒ¨ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£
    User[ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼]
    EmailProvider[ğŸ“§ SendGrid]
    
    %% ãƒ—ãƒ­ã‚»ã‚¹
    P1((1.0<br/>ãƒªãƒ³ã‚¯è¦æ±‚))
    P2((2.0<br/>ãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆ))
    P3((3.0<br/>ãƒ¡ãƒ¼ãƒ«é€ä¿¡))
    P4((4.0<br/>ãƒªãƒ³ã‚¯æ¤œè¨¼))
    P5((5.0<br/>ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆ))
    
    %% ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢
    TokenDB[(ãƒˆãƒ¼ã‚¯ãƒ³DB)]
    SessionDB[(ã‚»ãƒƒã‚·ãƒ§ãƒ³DB)]
    Cache[(ã‚­ãƒ£ãƒƒã‚·ãƒ¥)]
    
    %% ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼
    User -->|ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹| P1
    P1 -->|æ¤œè¨¼æ¸ˆã¿ã‚¢ãƒ‰ãƒ¬ã‚¹| P2
    P2 -->|ãƒˆãƒ¼ã‚¯ãƒ³| TokenDB
    P2 -->|é€ä¿¡ãƒ‡ãƒ¼ã‚¿| P3
    P3 -->|ãƒ¡ãƒ¼ãƒ«| EmailProvider
    EmailProvider -->|é…ä¿¡| User
    User -->|ãƒã‚¸ãƒƒã‚¯ãƒªãƒ³ã‚¯| P4
    P4 -->|ãƒˆãƒ¼ã‚¯ãƒ³ç…§åˆ| TokenDB
    P4 -->|èªè¨¼æˆåŠŸ| P5
    P5 -->|ã‚»ãƒƒã‚·ãƒ§ãƒ³| SessionDB
    P5 -->|ä¸€æ™‚ä¿å­˜| Cache
```

### ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼èª¬æ˜

1. **ãƒã‚¸ãƒƒã‚¯ãƒªãƒ³ã‚¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ•ãƒ­ãƒ¼**
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›
   - ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å½¢å¼æ¤œè¨¼ã¨ãƒ¬ãƒ¼ãƒˆåˆ¶é™ãƒã‚§ãƒƒã‚¯
   - æš—å·å­¦çš„ã«å®‰å…¨ãªãƒˆãƒ¼ã‚¯ãƒ³ã®ç”Ÿæˆï¼ˆ256ãƒ“ãƒƒãƒˆï¼‰
   - ãƒˆãƒ¼ã‚¯ãƒ³ã®ãƒãƒƒã‚·ãƒ¥åŒ–ã¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä¿å­˜
   - ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚­ãƒ¥ãƒ¼ã¸ã®ç™»éŒ²

2. **ãƒ¡ãƒ¼ãƒ«é€ä¿¡ãƒ•ãƒ­ãƒ¼**
   - SendGrid APIã‚’ä½¿ç”¨ã—ãŸãƒ¡ãƒ¼ãƒ«é€ä¿¡
   - HTMLã¨ãƒ†ã‚­ã‚¹ãƒˆã®ãƒãƒ«ãƒãƒ‘ãƒ¼ãƒˆå½¢å¼
   - ãƒªãƒ³ã‚¯ã®æœ‰åŠ¹æœŸé™ï¼ˆ15åˆ†ï¼‰ã‚’æ˜è¨˜
   - é…ä¿¡ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®è¿½è·¡

3. **èªè¨¼å‡¦ç†ãƒ•ãƒ­ãƒ¼**
   - ãƒã‚¸ãƒƒã‚¯ãƒªãƒ³ã‚¯ã®ãƒˆãƒ¼ã‚¯ãƒ³æŠ½å‡º
   - ãƒˆãƒ¼ã‚¯ãƒ³ã®æœ‰åŠ¹æ€§æ¤œè¨¼ï¼ˆæœŸé™ã€ä½¿ç”¨æ¸ˆã¿ã€ãƒãƒƒã‚·ãƒ¥ç…§åˆï¼‰
   - ã‚»ãƒƒã‚·ãƒ§ãƒ³ç”Ÿæˆã¨ Cookie è¨­å®š
   - ãƒˆãƒ¼ã‚¯ãƒ³ã®å³åº§ã®ç„¡åŠ¹åŒ–
   - ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¸ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ

## ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³

### ãƒã‚¸ãƒƒã‚¯ãƒªãƒ³ã‚¯èªè¨¼ã®å…¨ä½“ãƒ•ãƒ­ãƒ¼

```mermaid
sequenceDiagram
    participant U as ãƒ¦ãƒ¼ã‚¶ãƒ¼
    participant W as Webã‚¢ãƒ—ãƒª
    participant A as èªè¨¼API
    participant T as ãƒˆãƒ¼ã‚¯ãƒ³ã‚µãƒ¼ãƒ“ã‚¹
    participant E as ãƒ¡ãƒ¼ãƒ«ã‚µãƒ¼ãƒ“ã‚¹
    participant D as ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
    participant S as SendGrid

    U->>W: ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å…¥åŠ›
    W->>A: POST /api/auth/magic-link
    A->>A: ãƒ¬ãƒ¼ãƒˆåˆ¶é™ãƒã‚§ãƒƒã‚¯
    A->>T: generateToken()
    T->>T: 256ãƒ“ãƒƒãƒˆãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆ
    T->>D: ãƒˆãƒ¼ã‚¯ãƒ³ä¿å­˜ï¼ˆãƒãƒƒã‚·ãƒ¥åŒ–ï¼‰
    D-->>T: ä¿å­˜å®Œäº†
    T-->>A: ãƒˆãƒ¼ã‚¯ãƒ³è¿”å´
    A->>E: sendMagicLink()
    E->>S: ãƒ¡ãƒ¼ãƒ«é€ä¿¡APIå‘¼ã³å‡ºã—
    S-->>E: é€ä¿¡å®Œäº†
    E-->>A: é€ä¿¡ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
    A-->>W: æˆåŠŸãƒ¬ã‚¹ãƒãƒ³ã‚¹
    W-->>U: ç¢ºèªç”»é¢è¡¨ç¤º
    
    Note over U: ãƒ¡ãƒ¼ãƒ«å—ä¿¡
    
    U->>W: ãƒã‚¸ãƒƒã‚¯ãƒªãƒ³ã‚¯ã‚¯ãƒªãƒƒã‚¯
    W->>A: GET /api/auth/verify?token=xxx
    A->>T: verifyToken()
    T->>D: ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼
    D-->>T: ãƒˆãƒ¼ã‚¯ãƒ³æƒ…å ±
    T->>T: æœ‰åŠ¹æœŸé™ãƒ»ä½¿ç”¨æ¸ˆã¿ãƒã‚§ãƒƒã‚¯
    T->>D: ãƒˆãƒ¼ã‚¯ãƒ³ç„¡åŠ¹åŒ–
    T-->>A: æ¤œè¨¼çµæœ
    A->>A: ã‚»ãƒƒã‚·ãƒ§ãƒ³ç”Ÿæˆ
    A->>D: ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¿å­˜
    A-->>W: èªè¨¼Cookieè¨­å®š
    W-->>U: ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
```

## ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

#### ERD

```mermaid
erDiagram
    User {
        string id PK
        string email UK
        string name
        datetime createdAt
        datetime updatedAt
    }
    
    MagicLinkToken {
        string id PK
        string userId FK
        string hashedToken UK
        datetime expiresAt
        boolean used
        string ipAddress
        string userAgent
        datetime createdAt
    }
    
    Session {
        string id PK
        string userId FK
        string deviceFingerprint
        datetime expiresAt
        datetime createdAt
        datetime lastActivity
    }
    
    SecurityLog {
        string id PK
        string userId FK
        string eventType
        string ipAddress
        string deviceInfo
        json metadata
        datetime createdAt
    }
    
    User ||--o{ MagicLinkToken : generates
    User ||--o{ Session : has
    User ||--o{ SecurityLog : logs
```

#### Prismaã‚¹ã‚­ãƒ¼ãƒ

```prisma
model User {
  id              String            @id @default(cuid())
  email           String            @unique
  name            String?
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  magicLinkTokens MagicLinkToken[]
  sessions        Session[]
  securityLogs    SecurityLog[]
  
  @@index([email])
  @@map("users")
}

model MagicLinkToken {
  id          String   @id @default(cuid())
  userId      String
  hashedToken String   @unique
  expiresAt   DateTime
  used        Boolean  @default(false)
  ipAddress   String?
  userAgent   String?
  createdAt   DateTime @default(now())
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æˆ¦ç•¥
  @@index([hashedToken])           // ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼ã®é«˜é€ŸåŒ–
  @@index([userId, createdAt])     // ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥ã®å±¥æ­´å–å¾—
  @@index([expiresAt])              // æœŸé™åˆ‡ã‚Œãƒˆãƒ¼ã‚¯ãƒ³ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
  @@map("magic_link_tokens")
}

model Session {
  id               String   @id @default(cuid())
  userId           String
  deviceFingerprint String?
  expiresAt        DateTime
  createdAt        DateTime @default(now())
  lastActivity     DateTime @default(now())
  user             User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@index([userId])
  @@index([expiresAt])              // ã‚»ãƒƒã‚·ãƒ§ãƒ³æœŸé™ç®¡ç†
  @@map("sessions")
}

model SecurityLog {
  id         String   @id @default(cuid())
  userId     String
  eventType  String   // LOGIN, LOGOUT, TOKEN_REQUEST, etc.
  ipAddress  String?
  deviceInfo String?
  metadata   Json?
  createdAt  DateTime @default(now())
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@index([userId, eventType])      // ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ—åˆ¥ã®ç›£æŸ»
  @@index([createdAt])               // æ™‚ç³»åˆ—ã§ã®åˆ†æ
  @@map("security_logs")
}
```

### API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

| ãƒ¡ã‚½ãƒƒãƒ‰ | ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | èª¬æ˜ | ãƒªã‚¯ã‚¨ã‚¹ãƒˆ | ãƒ¬ã‚¹ãƒãƒ³ã‚¹ |
|---------|---------------|------|------------|------------|
| POST | `/api/auth/magic-link` | ãƒã‚¸ãƒƒã‚¯ãƒªãƒ³ã‚¯é€ä¿¡ | `{email: string}` | `{success: boolean, message: string}` |
| GET | `/api/auth/verify` | ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼ | `?token=xxx` | ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ or ã‚¨ãƒ©ãƒ¼ |
| POST | `/api/auth/logout` | ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ | - | `{success: boolean}` |
| GET | `/api/auth/session` | ã‚»ãƒƒã‚·ãƒ§ãƒ³ç¢ºèª | - | `{user: User \| null}` |
| POST | `/api/auth/resend` | ãƒªãƒ³ã‚¯å†é€ä¿¡ | `{email: string}` | `{success: boolean, message: string}` |

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

```typescript
// ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 
/components/auth/
â”œâ”€â”€ MagicLinkForm.tsx          // ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ 
â”œâ”€â”€ VerificationMessage.tsx    // é€ä¿¡ç¢ºèªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
â”œâ”€â”€ TokenVerifying.tsx         // ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼ä¸­ã®è¡¨ç¤º
â””â”€â”€ SessionProvider.tsx        // èªè¨¼çŠ¶æ…‹ç®¡ç†

/hooks/auth/
â”œâ”€â”€ useMagicLink.ts           // ãƒã‚¸ãƒƒã‚¯ãƒªãƒ³ã‚¯é€ä¿¡
â”œâ”€â”€ useSession.ts             // ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
â””â”€â”€ useAuth.ts                // èªè¨¼çŠ¶æ…‹

/services/auth/
â”œâ”€â”€ authApi.ts                // APIé€šä¿¡
â””â”€â”€ tokenStorage.ts           // ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†
```

## ç”»é¢è¨­è¨ˆ

### ç”»é¢ãƒ¯ã‚¤ãƒ¤ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ï¼ˆMermaidå›³ï¼‰

#### 1. ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ (Login Screen)

```mermaid
graph TB
    subgraph "ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢"
        Header[ãƒ˜ãƒƒãƒ€ãƒ¼: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å/ãƒ­ã‚´]
        Title[ã‚¿ã‚¤ãƒˆãƒ«: ãƒã‚¸ãƒƒã‚¯ãƒªãƒ³ã‚¯ã§ãƒ­ã‚°ã‚¤ãƒ³]
        Description[èª¬æ˜: ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ãƒªãƒ³ã‚¯ã‚’å—ã‘å–ã‚Šã¾ã™]
        EmailField[å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰: ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹<br/>placeholder: your@email.com]
        ValidationError[ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºã‚¨ãƒªã‚¢<br/>æ¡ä»¶ä»˜ãè¡¨ç¤º: ã‚¨ãƒ©ãƒ¼æ™‚ã®ã¿èµ¤æ–‡å­—]
        SubmitBtn[ãƒœã‚¿ãƒ³: ãƒ­ã‚°ã‚¤ãƒ³ãƒªãƒ³ã‚¯ã‚’é€ä¿¡<br/>çŠ¶æ…‹: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ/ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°/ç„¡åŠ¹åŒ–]
        LoadingIndicator[ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ãƒ”ãƒŠãƒ¼<br/>æ¡ä»¶ä»˜ãè¡¨ç¤º: é€ä¿¡ä¸­ã®ã¿]
        PasswordLink[ãƒªãƒ³ã‚¯: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§ãƒ­ã‚°ã‚¤ãƒ³<br/>â€»ä¸¦è¡Œé‹ç”¨æœŸé–“ä¸­ã®ã¿]

        Header --> Title
        Title --> Description
        Description --> EmailField
        EmailField --> ValidationError
        ValidationError --> SubmitBtn
        SubmitBtn --> LoadingIndicator
        LoadingIndicator --> PasswordLink
    end
```

**ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆè©³ç´°**:
- ä¸­å¤®å¯„ã›ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã€æœ€å¤§å¹…480px
- å„è¦ç´ é–“ã®ä½™ç™½: 16px
- ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰é«˜ã•: 48px
- ãƒœã‚¿ãƒ³é«˜ã•: 48px

**çŠ¶æ…‹ç®¡ç†**:
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: å…¨è¦ç´ è¡¨ç¤ºã€ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ã¯éè¡¨ç¤º
- å…¥åŠ›ä¸­: ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼è¡¨ç¤º
- é€ä¿¡ä¸­: ãƒœã‚¿ãƒ³ç„¡åŠ¹åŒ–ã€ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ãƒ”ãƒŠãƒ¼è¡¨ç¤º
- ã‚¨ãƒ©ãƒ¼: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰èµ¤æ 

#### 2. ãƒ¡ãƒ¼ãƒ«é€ä¿¡ç¢ºèªç”»é¢ (Email Sent Screen)

```mermaid
graph TB
    subgraph "ãƒ¡ãƒ¼ãƒ«é€ä¿¡ç¢ºèªç”»é¢"
        Header[ãƒ˜ãƒƒãƒ€ãƒ¼: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å/ãƒ­ã‚´]
        SuccessIcon[ã‚¢ã‚¤ã‚³ãƒ³: ãƒ¡ãƒ¼ãƒ«é€ä¿¡æˆåŠŸâœ“]
        Title[ã‚¿ã‚¤ãƒˆãƒ«: ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã—ãŸ]
        Message[ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: {email}å®›ã«ãƒ­ã‚°ã‚¤ãƒ³ãƒªãƒ³ã‚¯ã‚’é€ä¿¡ã—ã¾ã—ãŸ<br/>ãƒ¡ãƒ¼ãƒ«ã‚’ç¢ºèªã—ã¦ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„]
        ExpiryNote[æ³¨æ„æ›¸ã: ãƒªãƒ³ã‚¯ã¯15åˆ†é–“æœ‰åŠ¹ã§ã™]
        Divider[åŒºåˆ‡ã‚Šç·š]
        NoEmailTitle[ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«: ãƒ¡ãƒ¼ãƒ«ãŒå±Šãã¾ã›ã‚“ã‹ï¼Ÿ]
        CheckSpam[æ¡ˆå†…: è¿·æƒ‘ãƒ¡ãƒ¼ãƒ«ãƒ•ã‚©ãƒ«ãƒ€ã‚‚ç¢ºèªã—ã¦ãã ã•ã„]
        ResendBtn[ãƒœã‚¿ãƒ³: å†é€ä¿¡<br/>çŠ¶æ…‹: ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ä¸­ã¯ç„¡åŠ¹/1åˆ†å¾Œã«æœ‰åŠ¹åŒ–]
        Countdown[ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³è¡¨ç¤º: 00:XX<br/>æ¡ä»¶ä»˜ãè¡¨ç¤º: 1åˆ†é–“ã®ã¿]
        TryAnotherLink[ãƒªãƒ³ã‚¯: åˆ¥ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è©¦ã™]

        Header --> SuccessIcon
        SuccessIcon --> Title
        Title --> Message
        Message --> ExpiryNote
        ExpiryNote --> Divider
        Divider --> NoEmailTitle
        NoEmailTitle --> CheckSpam
        CheckSpam --> ResendBtn
        ResendBtn --> Countdown
        Countdown --> TryAnotherLink
    end
```

**ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆè©³ç´°**:
- ä¸­å¤®å¯„ã›ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã€æœ€å¤§å¹…540px
- æˆåŠŸã‚¢ã‚¤ã‚³ãƒ³ã‚µã‚¤ã‚º: 64x64px
- å†é€ä¿¡ãƒœã‚¿ãƒ³ã¯1åˆ†é–“ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³è¡¨ç¤º

**çŠ¶æ…‹ç®¡ç†**:
- åˆæœŸè¡¨ç¤º: å†é€ä¿¡ãƒœã‚¿ãƒ³ç„¡åŠ¹ã€ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³60ç§’é–‹å§‹
- ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ä¸­: ãƒœã‚¿ãƒ³ã«ã€Œå†é€ä¿¡ (00:XX)ã€ã¨è¡¨ç¤º
- ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³å®Œäº†: ãƒœã‚¿ãƒ³æœ‰åŠ¹åŒ–ã€ã€Œå†é€ä¿¡ã€ã®ã¿è¡¨ç¤º

#### 3. ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼ç”»é¢ (Token Verification Screen)

```mermaid
graph TB
    subgraph "ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼ç”»é¢"
        Header[ãƒ˜ãƒƒãƒ€ãƒ¼: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å/ãƒ­ã‚´]
        Spinner[ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ãƒ”ãƒŠãƒ¼: å¤§ã‚µã‚¤ã‚º]
        Message[ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: èªè¨¼ã—ã¦ã„ã¾ã™...<br/>ã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„]
        ProgressBar[ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼: ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼<br/>æ¡ä»¶ä»˜ãè¡¨ç¤º: 3ç§’ä»¥ä¸ŠçµŒéæ™‚]

        Header --> Spinner
        Spinner --> Message
        Message --> ProgressBar
    end
```

**ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆè©³ç´°**:
- ä¸­å¤®å¯„ã›ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã€æœ€å°é«˜ã•400px
- ã‚¹ãƒ”ãƒŠãƒ¼ã‚µã‚¤ã‚º: 48x48px
- è‡ªå‹•ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ: æ¤œè¨¼æˆåŠŸå¾Œ3ç§’ä»¥å†…

**çŠ¶æ…‹ç®¡ç†**:
- æ¤œè¨¼ä¸­: ã‚¹ãƒ”ãƒŠãƒ¼è¡¨ç¤ºã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
- 3ç§’ä»¥ä¸Š: ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼è¿½åŠ è¡¨ç¤º
- æ¤œè¨¼å®Œäº†: è‡ªå‹•ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ

#### 4. ã‚¨ãƒ©ãƒ¼ç”»é¢ (Error Screen)

```mermaid
graph TB
    subgraph "ã‚¨ãƒ©ãƒ¼ç”»é¢"
        Header[ãƒ˜ãƒƒãƒ€ãƒ¼: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å/ãƒ­ã‚´]
        ErrorIcon[ã‚¢ã‚¤ã‚³ãƒ³: ã‚¨ãƒ©ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³ âš ï¸]
        ErrorTitle[ã‚¿ã‚¤ãƒˆãƒ«: ã‚¨ãƒ©ãƒ¼ç¨®åˆ¥ã«ã‚ˆã‚Šå¤‰å‹•<br/>- ãƒªãƒ³ã‚¯ã®æœ‰åŠ¹æœŸé™ãŒåˆ‡ã‚Œã¦ã„ã¾ã™<br/>- ã“ã®ãƒªãƒ³ã‚¯ã¯æ—¢ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™<br/>- ç„¡åŠ¹ãªãƒªãƒ³ã‚¯ã§ã™<br/>- ãƒªã‚¯ã‚¨ã‚¹ãƒˆå›æ•°ã®ä¸Šé™ã«é”ã—ã¾ã—ãŸ]
        ErrorMessage[ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: ã‚¨ãƒ©ãƒ¼è©³ç´°ã¨å¯¾å‡¦æ³•]
        ActionBtn[ãƒœã‚¿ãƒ³: ãƒªã‚«ãƒãƒªãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³<br/>- æ–°ã—ã„ãƒªãƒ³ã‚¯ã‚’é€ä¿¡<br/>- ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹<br/>- æ™‚é–“çµŒéå¾Œãƒªãƒˆãƒ©ã‚¤]
        RetryAfter[ãƒªãƒˆãƒ©ã‚¤å¯èƒ½æ™‚åˆ»è¡¨ç¤º<br/>æ¡ä»¶ä»˜ãè¡¨ç¤º: ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚¨ãƒ©ãƒ¼æ™‚ã®ã¿]
        BackLink[ãƒªãƒ³ã‚¯: ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹]

        Header --> ErrorIcon
        ErrorIcon --> ErrorTitle
        ErrorTitle --> ErrorMessage
        ErrorMessage --> ActionBtn
        ActionBtn --> RetryAfter
        RetryAfter --> BackLink
    end
```

**ã‚¨ãƒ©ãƒ¼ç¨®åˆ¥ã”ã¨ã®è¡¨ç¤ºå†…å®¹**:

| ã‚¨ãƒ©ãƒ¼ç¨®åˆ¥ | ã‚¿ã‚¤ãƒˆãƒ« | ãƒœã‚¿ãƒ³ãƒ©ãƒ™ãƒ« | è¿½åŠ è¡¨ç¤º |
|-----------|---------|------------|---------|
| TOKEN_EXPIRED | ãƒªãƒ³ã‚¯ã®æœ‰åŠ¹æœŸé™ãŒåˆ‡ã‚Œã¦ã„ã¾ã™ | æ–°ã—ã„ãƒªãƒ³ã‚¯ã‚’é€ä¿¡ | - |
| TOKEN_USED | ã“ã®ãƒªãƒ³ã‚¯ã¯æ—¢ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ | æ–°ã—ã„ãƒªãƒ³ã‚¯ã‚’é€ä¿¡ | - |
| TOKEN_INVALID | ç„¡åŠ¹ãªãƒªãƒ³ã‚¯ã§ã™ | ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹ | - |
| RATE_LIMIT | ãƒªã‚¯ã‚¨ã‚¹ãƒˆå›æ•°ã®ä¸Šé™ã«é”ã—ã¾ã—ãŸ | - | æ¬¡å›ãƒªã‚¯ã‚¨ã‚¹ãƒˆå¯èƒ½æ™‚åˆ» |

#### 5. ã‚»ãƒƒã‚·ãƒ§ãƒ³ç„¡åŠ¹åŒ–ç¢ºèªç”»é¢ (Session Revocation Screen)

```mermaid
graph TB
    subgraph "ã‚»ãƒƒã‚·ãƒ§ãƒ³ç„¡åŠ¹åŒ–ç¢ºèªç”»é¢"
        Header[ãƒ˜ãƒƒãƒ€ãƒ¼: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å/ãƒ­ã‚´]
        WarningIcon[ã‚¢ã‚¤ã‚³ãƒ³: è­¦å‘Šã‚¢ã‚¤ã‚³ãƒ³ âš ï¸]
        Title[ã‚¿ã‚¤ãƒˆãƒ«: ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ç„¡åŠ¹åŒ–]
        Message[ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: ä»¥ä¸‹ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ç„¡åŠ¹åŒ–ã—ã¾ã™ã‹ï¼Ÿ]
        SessionInfo[ã‚»ãƒƒã‚·ãƒ§ãƒ³æƒ…å ±ã‚«ãƒ¼ãƒ‰<br/>- ãƒ‡ãƒã‚¤ã‚¹æƒ…å ±<br/>- IPã‚¢ãƒ‰ãƒ¬ã‚¹<br/>- ãƒ­ã‚°ã‚¤ãƒ³æ—¥æ™‚<br/>- æœ€çµ‚ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£]
        WarningNote[è­¦å‘Š: ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“]
        ButtonGroup[ãƒœã‚¿ãƒ³ã‚°ãƒ«ãƒ¼ãƒ—]
        RevokeBtn[ãƒœã‚¿ãƒ³: ç„¡åŠ¹åŒ–ã™ã‚‹ - å±é™ºã‚¢ã‚¯ã‚·ãƒ§ãƒ³]
        CancelBtn[ãƒœã‚¿ãƒ³: ã‚­ãƒ£ãƒ³ã‚»ãƒ« - é€šå¸¸ã‚¢ã‚¯ã‚·ãƒ§ãƒ³]

        Header --> WarningIcon
        WarningIcon --> Title
        Title --> Message
        Message --> SessionInfo
        SessionInfo --> WarningNote
        WarningNote --> ButtonGroup
        ButtonGroup --> RevokeBtn
        ButtonGroup --> CancelBtn
    end
```

**ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆè©³ç´°**:
- ä¸­å¤®å¯„ã›ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã€æœ€å¤§å¹…480px
- ãƒœã‚¿ãƒ³ã‚°ãƒ«ãƒ¼ãƒ—: æ¨ªä¸¦ã³é…ç½®ã€é–“éš”12px
- ç„¡åŠ¹åŒ–ãƒœã‚¿ãƒ³: èµ¤è‰²ç³»ï¼ˆå±é™ºã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼‰
- ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒœã‚¿ãƒ³: ã‚°ãƒ¬ãƒ¼ç³»ï¼ˆé€šå¸¸ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼‰

### ç”»é¢é·ç§»ãƒ•ãƒ­ãƒ¼å›³ï¼ˆè©³ç´°ç‰ˆï¼‰

```mermaid
stateDiagram-v2
    [*] --> LoginScreen: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¯ã‚»ã‚¹

    LoginScreen --> LoginScreen: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼
    LoginScreen --> EmailSentScreen: ãƒ¡ãƒ¼ãƒ«é€ä¿¡æˆåŠŸ

    EmailSentScreen --> EmailSentScreen: å†é€ä¿¡ï¼ˆ1åˆ†å¾…æ©Ÿå¾Œï¼‰
    EmailSentScreen --> RateLimitError: ãƒ¬ãƒ¼ãƒˆåˆ¶é™è¶…é
    EmailSentScreen --> LoginScreen: åˆ¥ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è©¦ã™

    RateLimitError --> LoginScreen: æ™‚é–“çµŒéå¾Œãƒªãƒˆãƒ©ã‚¤

    note right of EmailSentScreen
        ãƒ¡ãƒ¼ãƒ«å—ä¿¡
        â†“
        ãƒªãƒ³ã‚¯ã‚¯ãƒªãƒƒã‚¯
    end note

    EmailSentScreen --> VerificationScreen: ãƒªãƒ³ã‚¯ã‚¯ãƒªãƒƒã‚¯

    VerificationScreen --> Dashboard: æ¤œè¨¼æˆåŠŸ
    VerificationScreen --> ExpiredError: ãƒˆãƒ¼ã‚¯ãƒ³æœŸé™åˆ‡ã‚Œ
    VerificationScreen --> UsedError: ãƒˆãƒ¼ã‚¯ãƒ³ä½¿ç”¨æ¸ˆã¿
    VerificationScreen --> InvalidError: ãƒˆãƒ¼ã‚¯ãƒ³ç„¡åŠ¹

    ExpiredError --> LoginScreen: æ–°ã—ã„ãƒªãƒ³ã‚¯ã‚’é€ä¿¡
    UsedError --> LoginScreen: æ–°ã—ã„ãƒªãƒ³ã‚¯ã‚’é€ä¿¡
    InvalidError --> LoginScreen: ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹

    Dashboard --> SessionRevocationScreen: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é€šçŸ¥ã‹ã‚‰é·ç§»
    SessionRevocationScreen --> SessionRevoked: ç„¡åŠ¹åŒ–å®Ÿè¡Œ
    SessionRevocationScreen --> Dashboard: ã‚­ãƒ£ãƒ³ã‚»ãƒ«

    SessionRevoked --> [*]: å®Œäº†
    Dashboard --> [*]: ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
```

## UIã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³è¨­è¨ˆ

### ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè©³ç´°ä»•æ§˜

#### MagicLinkForm.tsx

**Props**:
```typescript
interface MagicLinkFormProps {
  onSubmit: (email: string) => Promise<void>;
  defaultEmail?: string;  // ã‚¨ãƒ©ãƒ¼å¾Œã®å†è¡¨ç¤ºç”¨
  isLoading?: boolean;
  error?: string | null;
}
```

**State**:
```typescript
interface MagicLinkFormState {
  email: string;
  validationError: string | null;
  isSubmitting: boolean;
  focusedField: 'email' | null;
}
```

**Events**:
- `onChange`: ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å…¥åŠ›æ™‚
- `onBlur`: ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚¢ã‚¦ãƒˆæ™‚ã€ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
- `onSubmit`: ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡æ™‚ã€ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å¾ŒAPIå‘¼ã³å‡ºã—

**ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚¸ãƒƒã‚¯**:
```typescript
const validateEmail = (email: string): string | null => {
  if (!email.trim()) return 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„';
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!emailRegex.test(email)) return 'æœ‰åŠ¹ãªãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„';
  return null;
};
```

**ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³è©³ç´°**:
1. **ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒ•ã‚©ãƒ¼ã‚«ã‚¹**
   - ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ™‚: æ ç·šè‰²å¤‰æ›´
   - ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚¢ã‚¦ãƒˆæ™‚: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ

2. **é€ä¿¡ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯**
   - ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
   - ã‚¨ãƒ©ãƒ¼ãŒã‚ã‚Œã°è¡¨ç¤ºã—ã¦return
   - ã‚¨ãƒ©ãƒ¼ãªã‘ã‚Œã°ãƒœã‚¿ãƒ³ç„¡åŠ¹åŒ–ã€ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
   - APIå‘¼ã³å‡ºã—
   - æˆåŠŸæ™‚: ç¢ºèªç”»é¢ã¸é·ç§»
   - å¤±æ•—æ™‚: ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºã€ãƒœã‚¿ãƒ³å†æœ‰åŠ¹åŒ–

3. **ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹**
   - ãƒœã‚¿ãƒ³å†…ã«ã‚¹ãƒ”ãƒŠãƒ¼è¡¨ç¤º
   - 3ç§’ä»¥ä¸Šã‹ã‹ã‚‹å ´åˆ: è¿½åŠ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º

#### VerificationMessage.tsx

**Props**:
```typescript
interface VerificationMessageProps {
  email: string;
  onResend: () => Promise<void>;
  onChangeEmail: () => void;
  expiryMinutes?: number;  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 15
}
```

**State**:
```typescript
interface VerificationMessageState {
  resendCountdown: number;  // ç§’å˜ä½
  canResend: boolean;
  isResending: boolean;
}
```

**Events**:
- `onResend`: å†é€ä¿¡ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯æ™‚
- `onChangeEmail`: åˆ¥ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è©¦ã™ãƒªãƒ³ã‚¯ã‚¯ãƒªãƒƒã‚¯æ™‚

**ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ãƒ­ã‚¸ãƒƒã‚¯**:
```typescript
useEffect(() => {
  const timer = setInterval(() => {
    setCountdown(prev => {
      if (prev <= 1) {
        setCanResend(true);
        return 0;
      }
      return prev - 1;
    });
  }, 1000);

  return () => clearInterval(timer);
}, []);
```

**ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³è©³ç´°**:
1. **åˆæœŸè¡¨ç¤º**
   - ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³60ç§’é–‹å§‹
   - å†é€ä¿¡ãƒœã‚¿ãƒ³ç„¡åŠ¹åŒ–
   - ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³è¡¨ç¤º: ã€Œå†é€ä¿¡ (00:XX)ã€

2. **ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³å®Œäº†**
   - å†é€ä¿¡ãƒœã‚¿ãƒ³æœ‰åŠ¹åŒ–
   - ãƒœã‚¿ãƒ³ãƒ©ãƒ™ãƒ«: ã€Œå†é€ä¿¡ã€

3. **å†é€ä¿¡ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯**
   - ãƒœã‚¿ãƒ³ç„¡åŠ¹åŒ–ã€ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
   - APIå‘¼ã³å‡ºã—
   - æˆåŠŸæ™‚: ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ãƒªã‚»ãƒƒãƒˆ
   - å¤±æ•—æ™‚: ã‚¨ãƒ©ãƒ¼è¡¨ç¤º

#### TokenVerifying.tsx

**Props**:
```typescript
interface TokenVerifyingProps {
  token: string;
  onSuccess: (user: User) => void;
  onError: (error: TokenVerificationError) => void;
}
```

**State**:
```typescript
interface TokenVerifyingState {
  status: 'verifying' | 'success' | 'error';
  elapsedTime: number;  // ç§’å˜ä½
  showProgressBar: boolean;
}
```

**Events**:
- `useEffect`: ãƒã‚¦ãƒ³ãƒˆæ™‚ã«è‡ªå‹•çš„ã«ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼é–‹å§‹
- `onVerificationComplete`: æ¤œè¨¼å®Œäº†æ™‚

**æ¤œè¨¼ãƒ•ãƒ­ãƒ¼**:
```typescript
useEffect(() => {
  const verifyToken = async () => {
    try {
      const result = await authApi.verifyToken(token);
      setStatus('success');
      setTimeout(() => onSuccess(result.user), 3000);
    } catch (error) {
      setStatus('error');
      onError(error);
    }
  };

  verifyToken();
}, [token]);
```

**ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³è©³ç´°**:
1. **æ¤œè¨¼ä¸­**
   - ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ãƒ”ãƒŠãƒ¼è¡¨ç¤º
   - ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: ã€Œèªè¨¼ã—ã¦ã„ã¾ã™...ã€
   - 3ç§’çµŒéå¾Œ: ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼è¿½åŠ è¡¨ç¤º

2. **æ¤œè¨¼æˆåŠŸ**
   - ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å¤‰æ›´: ã€Œãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã¾ã™...ã€
   - 3ç§’ä»¥å†…ã«è‡ªå‹•ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ

3. **æ¤œè¨¼å¤±æ•—**
   - ã‚¨ãƒ©ãƒ¼ç”»é¢ã¸é·ç§»
   - ã‚¨ãƒ©ãƒ¼ç¨®åˆ¥ã«å¿œã˜ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³è¡¨ç¤º

### ãƒ•ã‚©ãƒ¼ãƒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³è¨­è¨ˆ

**ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒŸãƒ³ã‚°**:
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³: å®Ÿæ–½ã—ãªã„ï¼ˆUXé…æ…®ï¼‰
- ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚¢ã‚¦ãƒˆæ™‚: å®Ÿæ–½ã™ã‚‹
- é€ä¿¡æ™‚: å¿…ãšå®Ÿæ–½ã™ã‚‹

**ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºãƒ«ãƒ¼ãƒ«**:
- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ç›´ä¸‹ã«èµ¤æ–‡å­—ã§è¡¨ç¤º
- ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æ : ã‚¨ãƒ©ãƒ¼æ™‚ã¯èµ¤è‰²ã«å¤‰æ›´
- ã‚¨ãƒ©ãƒ¼è‡ªå‹•æ¶ˆå»: ã—ãªã„ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä¿®æ­£ã™ã‚‹ã¾ã§è¡¨ç¤ºï¼‰

### ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ç®¡ç†

**ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼**:
- çŸ­æ™‚é–“ï¼ˆ< 3ç§’ï¼‰: ãƒœã‚¿ãƒ³å†…ã‚¹ãƒ”ãƒŠãƒ¼ã®ã¿
- é•·æ™‚é–“ï¼ˆâ‰¥ 3ç§’ï¼‰: è¿½åŠ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º

**ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ä¸­ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œåˆ¶é™**:
- ãƒœã‚¿ãƒ³ç„¡åŠ¹åŒ–
- ãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ç„¡åŠ¹åŒ–
- æˆ»ã‚‹ãƒœã‚¿ãƒ³/ãƒªãƒ­ãƒ¼ãƒ‰ã®è­¦å‘Šè¡¨ç¤ºï¼ˆæ¤œè¨¼ç”»é¢ï¼‰

### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°UI

**ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºãƒ‘ã‚¿ãƒ¼ãƒ³**:

1. **ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼** (ãƒ•ã‚©ãƒ¼ãƒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³)
   - ä½ç½®: ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ç›´ä¸‹
   - è‰²: èµ¤è‰²
   - ã‚¢ã‚¤ã‚³ãƒ³: ã‚¨ãƒ©ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆå°ï¼‰

2. **ãƒšãƒ¼ã‚¸ãƒ¬ãƒ™ãƒ«ã‚¨ãƒ©ãƒ¼** (API ã‚¨ãƒ©ãƒ¼)
   - ä½ç½®: å°‚ç”¨ã®ã‚¨ãƒ©ãƒ¼ç”»é¢
   - è‰²: èµ¤è‰²ç³»
   - ã‚¢ã‚¤ã‚³ãƒ³: ã‚¨ãƒ©ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆå¤§ï¼‰
   - ãƒªã‚«ãƒãƒªãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³å¿…é ˆ

3. **é€šçŸ¥ãƒãƒŠãƒ¼ã‚¨ãƒ©ãƒ¼** (ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é€šçŸ¥)
   - ä½ç½®: ãƒšãƒ¼ã‚¸ä¸Šéƒ¨
   - è‰²: é»„è‰²ç³»ï¼ˆè­¦å‘Šï¼‰ã¾ãŸã¯èµ¤è‰²ç³»ï¼ˆé‡å¤§ï¼‰
   - é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³: ã‚ã‚Š

## ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### ã‚¨ãƒ©ãƒ¼åˆ†é¡ã¨ã‚³ãƒ¼ãƒ‰ä½“ç³»

èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã§ç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ã®ã‚ã‚‹ã‚¨ãƒ©ãƒ¼ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«åˆ†é¡ã—ã¾ã™ï¼š

1. **æ¤œè¨¼ã‚¨ãƒ©ãƒ¼ (VALIDATION_ERROR)**
   - ç„¡åŠ¹ãªãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å½¢å¼
   - å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®æ¬ è½
   - ä¸æ­£ãªå…¥åŠ›å€¤

2. **èªè¨¼ã‚¨ãƒ©ãƒ¼ (AUTH_ERROR)**
   - æœŸé™åˆ‡ã‚Œãƒˆãƒ¼ã‚¯ãƒ³
   - ä½¿ç”¨æ¸ˆã¿ãƒˆãƒ¼ã‚¯ãƒ³
   - ç„¡åŠ¹ãªãƒˆãƒ¼ã‚¯ãƒ³
   - ã‚»ãƒƒã‚·ãƒ§ãƒ³æœŸé™åˆ‡ã‚Œ

3. **ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚¨ãƒ©ãƒ¼ (RATE_LIMIT_ERROR)**
   - çŸ­æ™‚é–“ã§ã®éå‰°ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆ
   - 1æ—¥ã®é€ä¿¡ä¸Šé™è¶…é

4. **ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼ (SYSTEM_ERROR)**
   - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚¨ãƒ©ãƒ¼
   - ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚µãƒ¼ãƒ“ã‚¹ã®éšœå®³
   - å†…éƒ¨ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼

### ã‚¨ãƒ©ãƒ¼å‡¦ç†æˆ¦ç•¥

- **ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**: æŠ€è¡“çš„è©³ç´°ã‚’å«ã¾ãªã„ã€ç†è§£ã—ã‚„ã™ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
- **é–‹ç™ºè€…å‘ã‘ãƒ­ã‚°**: è©³ç´°ãªã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ã¨ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæƒ…å ±ã‚’è¨˜éŒ²
- **ãƒªãƒˆãƒ©ã‚¤å¯èƒ½æ€§ã®æç¤º**: ã‚¨ãƒ©ãƒ¼ã®ç¨®é¡ã«å¿œã˜ã¦ã€å†è©¦è¡Œãƒœã‚¿ãƒ³ã‚„ä»£æ›¿ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’æä¾›
- **ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†**: ãƒ¡ãƒ¼ãƒ«é€ä¿¡å¤±æ•—æ™‚ã¯å†é€ä¿¡ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æä¾›

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

### èªè¨¼ãƒ»èªå¯ã®å®Ÿè£…

1. **ãƒˆãƒ¼ã‚¯ãƒ³ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**
   - æš—å·å­¦çš„ã«å®‰å…¨ãª256ãƒ“ãƒƒãƒˆã®ãƒ©ãƒ³ãƒ€ãƒ ãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆ
   - bcryptã«ã‚ˆã‚‹ãƒˆãƒ¼ã‚¯ãƒ³ã®ãƒãƒƒã‚·ãƒ¥åŒ–ä¿å­˜
   - ä½¿ç”¨å¾Œã®å³åº§ã®ç„¡åŠ¹åŒ–

2. **ãƒ¬ãƒ¼ãƒˆåˆ¶é™**
   - IPã‚¢ãƒ‰ãƒ¬ã‚¹ãƒ™ãƒ¼ã‚¹: 1åˆ†ã‚ãŸã‚Š3å›ã¾ã§
   - ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒ™ãƒ¼ã‚¹: 1åˆ†ã‚ãŸã‚Š1å›ã¾ã§
   - 1æ—¥ã‚ãŸã‚Šã®ä¸Šé™: åŒä¸€ãƒ¡ãƒ¼ãƒ«ã§20å›ã¾ã§

3. **ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†**
   - HTTPOnly Cookieã§ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
   - Secure ãƒ•ãƒ©ã‚°ã®è¨­å®šï¼ˆHTTPSç’°å¢ƒï¼‰
   - SameSiteå±æ€§ã«ã‚ˆã‚‹CSRFå¯¾ç­–

### ãƒ‡ãƒ¼ã‚¿ä¿è­·æˆ¦ç•¥

- **å€‹äººæƒ…å ±ã®æš—å·åŒ–**: ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãªã©ã®å€‹äººæƒ…å ±ã¯æš—å·åŒ–ã—ã¦ä¿å­˜
- **ãƒˆãƒ¼ã‚¯ãƒ³ã®å®‰å…¨ãªä¿å­˜**: ãƒãƒƒã‚·ãƒ¥åŒ–ã«ã‚ˆã‚Šã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¼æ´©æ™‚ã‚‚ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä¿è­·
- **é€šä¿¡ã®æš—å·åŒ–**: HTTPSå¿…é ˆã€TLS 1.2ä»¥ä¸Š
- **ãƒ­ã‚°ã®ã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³**: å€‹äººæƒ…å ±ã‚„ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ãƒ­ã‚°ã«å«ã‚ãªã„

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥**
  - Redisã«ã‚ˆã‚‹ã‚»ãƒƒã‚·ãƒ§ãƒ³æƒ…å ±ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥
  - ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã®ãƒ¡ãƒ¢ãƒªã‚­ãƒ£ãƒƒã‚·ãƒ¥
  - é™çš„ã‚¢ã‚»ãƒƒãƒˆã®CDNé…ä¿¡

- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æœ€é©åŒ–**
  - é©åˆ‡ãªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã«ã‚ˆã‚‹ã‚¯ã‚¨ãƒªé«˜é€ŸåŒ–
  - æœŸé™åˆ‡ã‚Œãƒˆãƒ¼ã‚¯ãƒ³ã®å®šæœŸå‰Šé™¤ãƒãƒƒãƒ
  - ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ¼ãƒªãƒ³ã‚°ã®æ´»ç”¨

- **éåŒæœŸå‡¦ç†**
  - ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã®ã‚­ãƒ¥ãƒ¼ã‚¤ãƒ³ã‚°
  - ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ­ã‚°è¨˜éŒ²
  - éåŒæœŸãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å‡¦ç†

## ãƒ†ã‚¹ãƒˆè¨­è¨ˆ

### å˜ä½“ãƒ†ã‚¹ãƒˆ

#### æ­£å¸¸ç³»ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

1. **ãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆå‡¦ç†**
   - Given: æœ‰åŠ¹ãªãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒæä¾›ã•ã‚Œã‚‹
   - When: ãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆé–¢æ•°ã‚’å®Ÿè¡Œã™ã‚‹
   - Then: 256ãƒ“ãƒƒãƒˆã®æš—å·å­¦çš„ã«å®‰å…¨ãªãƒˆãƒ¼ã‚¯ãƒ³ãŒç”Ÿæˆã•ã‚Œã‚‹

2. **ãƒ¡ãƒ¼ãƒ«é€ä¿¡å‡¦ç†**
   - Given: æœ‰åŠ¹ãªãƒˆãƒ¼ã‚¯ãƒ³ã¨ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒå­˜åœ¨ã™ã‚‹
   - When: ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚µãƒ¼ãƒ“ã‚¹ã‚’å‘¼ã³å‡ºã™
   - Then: SendGrid APIãŒæ­£ã—ã„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§å‘¼ã³å‡ºã•ã‚Œã‚‹

#### ç•°å¸¸ç³»ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

1. **ç„¡åŠ¹ãªãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹**
   - Given: ä¸æ­£ãªå½¢å¼ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒå…¥åŠ›ã•ã‚Œã‚‹
   - When: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹
   - Then: VALIDATION_ERRORãŒè¿”ã•ã‚Œã€å‡¦ç†ãŒä¸­æ–­ã•ã‚Œã‚‹

2. **ãƒ¬ãƒ¼ãƒˆåˆ¶é™è¶…é**
   - Given: åŒä¸€IPã‹ã‚‰1åˆ†ä»¥å†…ã«4å›ç›®ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒæ¥ã‚‹
   - When: ãƒ¬ãƒ¼ãƒˆåˆ¶é™ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œã™ã‚‹
   - Then: RATE_LIMIT_ERRORãŒè¿”ã•ã‚Œã€429ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ãŒè¿”ã•ã‚Œã‚‹

### çµ±åˆãƒ†ã‚¹ãƒˆ

- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¨ã®é€£æºç¢ºèª
- ãƒ¡ãƒ¼ãƒ«ã‚µãƒ¼ãƒ“ã‚¹ã¨ã®é€šä¿¡ãƒ†ã‚¹ãƒˆ
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¨ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¹ãƒˆã‚¢ã®å‹•ä½œç¢ºèª
- è¤‡æ•°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé–“ã®ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼æ¤œè¨¼

### E2Eãƒ†ã‚¹ãƒˆ

1. **å®Œå…¨ãªèªè¨¼ãƒ•ãƒ­ãƒ¼**
   - Given: æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹
   - When: ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã€å—ä¿¡ã—ãŸãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯
   - Then: ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«ãƒ­ã‚°ã‚¤ãƒ³ã§ãã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒç¢ºç«‹ã•ã‚Œã‚‹

2. **ãƒˆãƒ¼ã‚¯ãƒ³æœŸé™åˆ‡ã‚Œã‚·ãƒŠãƒªã‚ª**
   - Given: 15åˆ†ä»¥ä¸ŠçµŒéã—ãŸãƒã‚¸ãƒƒã‚¯ãƒªãƒ³ã‚¯ã‚’æŒã¤ãƒ¦ãƒ¼ã‚¶ãƒ¼
   - When: ãã®ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹
   - Then: æœŸé™åˆ‡ã‚Œã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã€å†é€ä¿¡ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒæç¤ºã•ã‚Œã‚‹

## ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æˆ¦ç•¥

Prismaã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ãŸã‚ã€é€šå¸¸ã®ã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´ã¯`prisma migrate dev`ã§è‡ªå‹•å‡¦ç†ã•ã‚Œã¾ã™ã€‚

### ç‰¹åˆ¥ãªãƒ‡ãƒ¼ã‚¿ç§»è¡ŒãŒå¿…è¦ãªã‚±ãƒ¼ã‚¹

æ—¢å­˜ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã‹ã‚‰ã®ç§»è¡Œæ™‚ï¼š
1. æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ä¿æŒ
2. ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æ®µéšçš„ã«éæ¨å¥¨åŒ–
3. ç§»è¡ŒæœŸé–“ä¸­ã¯ä¸¡æ–¹ã®èªè¨¼æ–¹å¼ã‚’ä¸¦è¡Œé‹ç”¨
4. å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç§»è¡Œå®Œäº†å¾Œã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰é–¢é€£ã®ã‚³ãƒ¼ãƒ‰ã‚’å‰Šé™¤

## ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã¨åˆ†æ

- **åé›†ã™ã‚‹ãƒ¡ãƒˆãƒªã‚¯ã‚¹**
  - ãƒã‚¸ãƒƒã‚¯ãƒªãƒ³ã‚¯ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°ã¨æˆåŠŸç‡
  - ãƒˆãƒ¼ã‚¯ãƒ³ã®æœ‰åŠ¹æœŸé™åˆ‡ã‚Œç‡
  - ãƒ¡ãƒ¼ãƒ«é…ä¿¡æˆåŠŸç‡
  - å¹³å‡èªè¨¼å®Œäº†æ™‚é–“

- **ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®š**
  - ãƒ¡ãƒ¼ãƒ«é€ä¿¡å¤±æ•—ç‡ãŒ5%ã‚’è¶…ãˆãŸå ´åˆ
  - èªè¨¼æˆåŠŸç‡ãŒ90%ã‚’ä¸‹å›ã£ãŸå ´åˆ
  - ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚¨ãƒ©ãƒ¼ãŒæ€¥å¢—ã—ãŸå ´åˆ

## å®Ÿè£…ä¸Šã®æ³¨æ„ç‚¹

### ã‚³ãƒ¼ãƒ‰å“è³ªã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

- ãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆã«ã¯å¿…ãšæš—å·å­¦çš„ã«å®‰å…¨ãªä¹±æ•°ç”Ÿæˆå™¨ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨
- ç’°å¢ƒå¤‰æ•°ã§æ©Ÿå¯†æƒ…å ±ã‚’ç®¡ç†ã—ã€ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã¯çµ¶å¯¾ã«é¿ã‘ã‚‹
- ã™ã¹ã¦ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã«å¯¾ã—ã¦é©åˆ‡ãªãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿæ–½
- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«æ©Ÿå¯†æƒ…å ±ã‚„å®Ÿè£…ã®è©³ç´°ã‚’å«ã‚ãªã„

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¨ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£

- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒªã¯å¿…è¦æœ€å°é™ã«æŠ‘ãˆã€N+1å•é¡Œã‚’å›é¿
- éåŒæœŸå‡¦ç†ã‚’æ´»ç”¨ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å¾…ã¡æ™‚é–“ã‚’æœ€å°åŒ–
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’é©åˆ‡ã«æ´»ç”¨ã™ã‚‹ãŒã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æƒ…å ±ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¯æ…é‡ã«

### ä¿å®ˆæ€§ã¨æ‹¡å¼µæ€§

- èªè¨¼ãƒ­ã‚¸ãƒƒã‚¯ã‚’ç‹¬ç«‹ã—ãŸã‚µãƒ¼ãƒ“ã‚¹ã¨ã—ã¦å®Ÿè£…ã—ã€ç–çµåˆã‚’ç¶­æŒ
- è¨­å®šå€¤ã¯ç’°å¢ƒå¤‰æ•°ã‚„ã‚³ãƒ³ãƒ•ã‚£ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã§ç®¡ç†ã—ã€å¤‰æ›´ã‚’å®¹æ˜“ã«
- ãƒ­ã‚°ã¯æ§‹é€ åŒ–å½¢å¼ã§å‡ºåŠ›ã—ã€åˆ†æã‚„ç›£è¦–ã‚’å®¹æ˜“ã«
- ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸80%ä»¥ä¸Šã‚’ç¶­æŒã—ã€ãƒªã‚°ãƒ¬ãƒƒã‚·ãƒ§ãƒ³ã‚’é˜²æ­¢