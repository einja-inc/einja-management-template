# シナリオテスト

## 概要
このファイルは、複数タスクをまたぐ継続操作のシナリオテストを定義します。
各タスク完了後に、該当するシナリオテストを実行してください。

---

## シナリオ1: Todo完全CRUDフロー

### 目的
ユーザーがTodoを作成、一覧表示、更新（完了状態切り替え）、削除できる一連のフローを検証する。

### 関連
- **受け入れ条件**: AC2.1, AC3.1, AC3.4, AC4.1, AC5.1, AC5.2, AC6.1, AC6.2, AC6.3, AC6.4
- **関連タスク**: Story 2, 3, 4, 5, 6（全フェーズ）

### 実施タイミング
- **Phase 1完了後**: Step 1-2まで（部分実行：データモデル・マイグレーション確認）
- **Phase 2 API層完了後**: Step 1-7まで（部分実行：API統合テスト）
- **Phase 2 UI層完了後**: 全Step（フル実行：完全なエンドツーエンド確認）
- **リグレッション**: 後続のバグ修正時に再実行

### テスト手順

| Step | 操作 | 確認項目 | 期待値 | 結果 |
|------|------|---------|--------|------|
| 1 | Prismaスキーマ確認 | Todoモデル定義 | id, title, completed, createdAt, updatedAtが定義されている | - |
| 2 | マイグレーション実行 (pnpm db:push) | DBにtodoテーブル作成 | テーブルとカラムが正しく作成される | - |
| 3 | POST /api/todos (title: "買い物に行く") | Todo作成 | 201 Created、作成されたTodoオブジェクトが返る | - |
| 4 | GET /api/todos | Todo一覧取得 | 200 OK、作成したTodoが配列に含まれる | - |
| 5 | PUT /api/todos/:id (completed: true) | Todo完了状態切り替え | 200 OK、completedがtrueになる | - |
| 6 | GET /api/todos/:id | 更新確認 | 完了状態のTodoが取得できる | - |
| 7 | DELETE /api/todos/:id | Todo削除 | 204 No Content | - |
| 8 | GET /api/todos/:id | 削除確認 | 404 Not Found | - |
| 9 | ブラウザでplayground/todo-appに移動 | UI表示 | Todo一覧画面が表示される | - |
| 10 | フォームに"レポート提出"と入力して送信 | Todo追加 | 新しいTodoが一覧に追加される | - |
| 11 | チェックボックスをクリック | 完了状態切り替え | 取り消し線とグレー表示になる | - |
| 12 | 削除ボタンをクリック | 削除確認ダイアログ | "このTodoを削除しますか？"が表示される | - |
| 13 | OKをクリック | Todo削除 | Todoが一覧から消える | - |

### 実行ログ
（実施後に記載）

---

## シナリオ2: バリデーションとエラーハンドリング

### 目的
各種バリデーションエラーと異常系が適切にハンドリングされることを検証する。

### 関連
- **受け入れ条件**: AC3.2, AC3.3, AC4.3, AC4.4, AC5.3, AC6.6
- **関連タスク**: Story 3, 4, 5, 6

### 実施タイミング
- **Phase 2 API層完了後**: Step 1-6まで（部分実行：APIバリデーション）
- **Phase 2 UI層完了後**: 全Step（フル実行：UIエラー表示含む）
- **リグレッション**: バリデーション変更時に再実行

### テスト手順

| Step | 操作 | 確認項目 | 期待値 | 結果 |
|------|------|---------|--------|------|
| 1 | POST /api/todos (titleなし) | 必須フィールドバリデーション | 400 Bad Request、"Title is required" | - |
| 2 | POST /api/todos (title: "") | 空文字バリデーション | 400 Bad Request、"Title is required" | - |
| 3 | POST /api/todos (title: "a" x 256文字) | 文字数制限バリデーション | 400 Bad Request、"Title must be 255 characters or less" | - |
| 4 | PUT /api/todos/nonexistent | 存在しないリソース更新 | 404 Not Found、"Todo not found" | - |
| 5 | PUT /api/todos/:id (completed: "invalid") | 型バリデーション | 400 Bad Request、"Invalid data" | - |
| 6 | DELETE /api/todos/nonexistent | 存在しないリソース削除 | 404 Not Found、"Todo not found" | - |
| 7 | ブラウザでフォームに空欄で送信 | UIバリデーション | フォーム送信されない（クライアント側検証） | - |
| 8 | APIエラー発生時（DB停止） | エラー表示 | "Todoの取得に失敗しました。再試行してください。" | - |
| 9 | 再試行ボタンクリック | リトライ処理 | API再呼び出しが実行される | - |

### 実行ログ
（実施後に記載）

---

## シナリオ3: データ永続化と整合性

### 目的
データベースへの永続化と、リロード後もデータが保持されることを確認する。

### 関連
- **受け入れ条件**: AC1.2, AC3.4, AC6.1, AC6.2
- **関連タスク**: Story 1, 3, 6

### 実施タイミング
- **Phase 1完了後**: Step 1-4まで（部分実行：DBレベルの確認）
- **Phase 2 UI層完了後**: 全Step（フル実行：UI経由の永続化確認）
- **リグレッション**: DBスキーマ変更時に再実行

### テスト手順

| Step | 操作 | 確認項目 | 期待値 | 結果 |
|------|------|---------|--------|------|
| 1 | POST /api/todos (title: "テストTodo1") | Todo作成 | 201 Created | - |
| 2 | POST /api/todos (title: "テストTodo2") | Todo作成 | 201 Created | - |
| 3 | GET /api/todos | 一覧取得 | 2件のTodoが返る | - |
| 4 | DBを直接確認 (Prisma Studio) | DB永続化 | todosテーブルに2レコード存在 | - |
| 5 | ブラウザでTodo一覧表示 | UI表示 | 2件のTodoが表示される | - |
| 6 | 1件のTodoを完了状態に変更 | 状態更新 | 取り消し線とグレー表示になる | - |
| 7 | ブラウザをリロード (F5) | データ保持 | 2件のTodoが表示され、1件が完了状態 | - |
| 8 | 1件のTodoを削除 | データ削除 | Todoが一覧から消える | - |
| 9 | ブラウザをリロード (F5) | 削除確認 | 1件のTodoのみ表示される | - |
| 10 | DBを直接確認 (Prisma Studio) | DB整合性 | todosテーブルに1レコードのみ存在 | - |

### 実行ログ
（実施後に記載）

---

## シナリオ4: ローディング状態とUX

### 目的
API呼び出し中のローディング状態が適切に表示され、ユーザーに視覚的フィードバックが提供されることを確認する。

### 関連
- **受け入れ条件**: AC6.5
- **関連タスク**: Story 6

### 実施タイミング
- **Phase 2 UI層完了後**: 全Step（フル実行）
- **リグレッション**: UI変更時に再実行

### テスト手順

| Step | 操作 | 確認項目 | 期待値 | 結果 |
|------|------|---------|--------|------|
| 1 | ブラウザでplayground/todo-appに移動 | 初回ローディング | "読み込み中..."が表示される | - |
| 2 | データ取得完了 | ローディング終了 | Todo一覧が表示される | - |
| 3 | フォームに"新しいTodo"と入力 | - | - | - |
| 4 | 送信ボタンをクリック | ボタン状態 | ボタンが無効化され、クリック不可になる | - |
| 5 | - | API呼び出し中 | ローディングインジケーター（スピナー等）が表示される | - |
| 6 | Todo作成完了 | ボタン復帰 | ボタンが再度有効化される | - |
| 7 | チェックボックスをクリック | 更新中状態 | ローディング状態が視覚的に分かる（スピナー等） | - |
| 8 | 更新完了 | 状態反映 | 完了状態に変更される | - |

### 実行ログ
（実施後に記載）

---

## シナリオ5: 空のTodoリスト表示

### 目的
Todoが1件も存在しない場合、適切な空状態メッセージが表示されることを確認する。

### 関連
- **受け入れ条件**: AC2.2, AC6.1
- **関連タスク**: Story 2, 6

### 実施タイミング
- **Phase 2 API層完了後**: Step 1-2まで（部分実行：APIレスポンス）
- **Phase 2 UI層完了後**: 全Step（フル実行：UI表示）
- **リグレッション**: UI変更時に再実行

### テスト手順

| Step | 操作 | 確認項目 | 期待値 | 結果 |
|------|------|---------|--------|------|
| 1 | DBのtodosテーブルを空にする | - | - | - |
| 2 | GET /api/todos | 空配列取得 | 200 OK、空配列[]が返る | - |
| 3 | ブラウザでplayground/todo-appに移動 | 空状態表示 | "Todoがありません"が表示される | - |
| 4 | フォームに"最初のTodo"と入力して送信 | Todo追加 | Todoが一覧に追加され、空状態メッセージが消える | - |
| 5 | 追加したTodoを削除 | 空状態復帰 | "Todoがありません"が再度表示される | - |

### 実行ログ
（実施後に記載）
