# Claude Code 共有リポジトリ化 - 評価・分析ドキュメント

## 📚 概要

このディレクトリには、Claude Code設定専用のSingle Source of Truth（SOT）リポジトリを作成し、`einja-management-template`を参考実装+PoC環境として再定義するための分析結果と実装計画が含まれています。

## 📖 ドキュメント構成

### 1. [エグゼクティブサマリー](./00-executive-summary.md)
- プロジェクト概要と新方針（SOT分離戦略）
- 現状の主要な問題点
- 推奨戦略4の概要と決定的な5つの利点
- 期待される成果と実装計画
- **更新**: 戦略4（SOT分離）を唯一の推奨案として採用（v2.0.0）

**読者**: プロジェクトマネージャー、意思決定者
**読了時間**: 8分

---

### 2. [現状分析](./01-current-analysis.md)
- `.claude`ディレクトリの詳細構造
- 各エージェント・コマンドの役割と依存関係
- プロジェクト固有要素 vs 汎用要素の分類
- 技術スタック依存度の評価
- アプリケーションコードとの混在状況

**読者**: 開発者、アーキテクト
**読了時間**: 15分

---

### 3. [共有戦略の評価](./02-sharing-strategies.md)
- **戦略4: SOT分離戦略**（✅ 採用案 - 47/50点）
- 戦略1: 専用共有リポジトリへの分離（37/50点 - 参考）
- 戦略2: 現リポジトリの再構成（32/50点 - 暫定的妥協案、非推奨）
- 戦略3: 現状維持（14/50点 - 非推奨）
- 戦略4の徹底的批判的評価（5つの利点、4つの懸念への反論）
- 10項目の詳細比較表
- 戦略1・2・3を採用しない理由
- **更新**: 戦略4を唯一の推奨案として採用、他戦略は参考として記載

**読者**: 開発者、アーキテクト、プロジェクトマネージャー
**読了時間**: 30分

---

### 3. [SOT分離詳細設計](./05-sot-separation-details.md)（✅ 現行実装計画）
- claude-code-sharedリポジトリの詳細仕様
- einja-management-templateの再定義
- install.sh/update.shの詳細仕様
- バージョン管理戦略（完全版）
- 技術スタック拡張戦略
- トラブルシューティング
- 実装スケジュール（3-4週間）
- 成功指標（KPI）
- 参考: 削除された03との差分

**読者**: 開発者、実装担当者、アーキテクト
**読了時間**: 30分

---

### 4. [シンボリックリンク vs コピーの評価](./04-symlink-vs-copy.md)
- 検証環境の必要性と要件
- シンボリックリンク方式の詳細評価
- 実ファイルコピー方式の詳細評価
- クロスプラットフォーム対応
- 開発フロー比較
- 推奨方式と理由
- **注記**: 戦略4では実ファイルコピー方式を採用

**読者**: 開発者、インフラ担当者
**読了時間**: 15分

---

## 🎯 推奨読了順序

### 最初に全体像を把握したい場合
1. **エグゼクティブサマリー** (00) - 戦略4の概要と決定的理由
2. **共有戦略の評価** (02) - 戦略4の詳細評価と他戦略との比較
3. **SOT分離詳細設計** (05) - 戦略4の詳細仕様

### 詳細な技術検討が必要な場合
1. **エグゼクティブサマリー** (00)
2. **現状分析** (01)
3. **共有戦略の評価** (02)
4. **SOT分離詳細設計** (05)
5. **シンボリックリンク vs コピーの評価** (04)

### 実装を開始する場合
1. **SOT分離詳細設計** (05) ← 現行実装計画
2. **シンボリックリンク vs コピーの評価** (04)
3. 必要に応じて **現状分析** (01) を参照

---

## 📊 ドキュメント作成背景

### 分析日時
- 初版: 2025-11-24
- 更新: 2025-11-30（戦略4採用）

### 分析対象
- リポジトリ: `einja-management-template`
- ブランチ: `main`
- コミット: `bc49657` (Merge pull request #3)

### ユーザー要件の変更

#### 旧要件（v1.0.0）
- **目的**: Next.js/Reactプロジェクトのみで共有（技術スタック維持）
- **方針**: 現リポジトリを再構成（新規リポジトリは作らない）
- **期間**: 2-3週間（中規模リファクタリング）

#### 新要件（v2.0.0）
- **目的**: Claude Code設定のSingle Source of Truth（SOT）を確立
- **方針**: リポジトリの分離が可能 → 責務の完全な単一化を追求
- **期間**: 3-4週間（正しい構造を最初から採用）
- **重要**:
  - claude-code-shared: Claude Code設定専用リポジトリ（SOT）
  - einja-management-template: Next.js/React参考実装+PoC環境

---

## 🔍 主要な発見事項（要約）

### 根本的な問題（戦略4で解決）

1. **リポジトリの責務混在**
   - 現状: アプリケーションコード、Claude Code設定、検証環境が同一リポジトリ
   - 戦略4: リポジトリごとに責務を100%明確化

2. **Single Source of Truthの不在**
   - 現状: バージョン管理が分散、または不在
   - 戦略4: claude-code-sharedが唯一のバージョン管理ポイント

3. **技術スタック依存の混乱**
   - 現状: 汎用部分（task/specs）と特化部分（frontend-*）が分離されていない
   - 戦略4: claude-code-sharedで両者を明確に管理

4. **検証環境の不明確性**
   - 現状: シンボリックリンクによる暗黙的依存、本番との差異
   - 戦略4: einja-management-templateが本番同様の検証環境

### 戦略4の決定的な利点

1. **概念的明確性**: リポジトリの責務が100%明確
2. **真のSOT確立**: 唯一のバージョン管理ポイント
3. **完璧なスケーラビリティ**: 複数技術スタックへの対応が容易
4. **最高の保守性**: 影響範囲が100%明確
5. **明示的な開発フロー**: 暗黙的依存を排除

詳細は [共有戦略の評価](./02-sharing-strategies.md) を参照。

---

## 💡 推奨アクション（要約）

### Week 1: claude-code-sharedリポジトリ作成
1. **新規リポジトリ作成** - claude-code-sharedの基本構造整備
2. **バージョン管理確立** - セマンティックバージョニング導入
3. **エージェント・コマンド移行計画** - 汎用/特化の明確な分類

### Week 2: スクリプト開発
1. **install.sh開発** - インタラクティブプロンプト、バージョン指定機能
2. **update.sh開発** - 更新配信、ロールバック機能
3. **テスト** - 複数プロジェクトでの動作確認

### Week 3: einja-management-template再定義
1. **参考実装+PoC環境として再定義** - 役割の明確化
2. **update-from-sot.sh作成** - SOTからの更新フロー確立
3. **検証フロー確立** - 本番同様の動作確認

### Week 4: リリース準備
1. **ドキュメント整備** - SOT、参考実装の使用方法
2. **CI/CD構築** - 自動テスト、リリースプロセス
3. **v1.0.0リリース** - 組織内展開開始

詳細は [SOT分離詳細設計](./05-sot-separation-details.md) を参照。

---

## 📊 戦略比較（要約）

| 戦略 | 総合スコア | 主な特徴 | 推奨度 |
|------|-----------|---------|--------|
| **戦略4: SOT分離** | **47/50** | リポジトリ責務の完全単一化、真のSOT確立 | ⭐⭐⭐⭐⭐ **採用** |
| 戦略1: 専用リポジトリ | 37/50 | 概念的には優れているが検証環境が不在 | ⭐⭐⭐⭐ 高（ただし戦略4に劣る） |
| 戦略2: 現リポジトリ再構成 | 32/50 | 暫定的な妥協案、最終的に戦略4への移行が必要 | ⭐⭐⭐ 中（非推奨） |
| 戦略3: 現状維持 | 14/50 | 明らかに不適切 | ⭐ 低（非推奨） |

詳細は [共有戦略の評価](./02-sharing-strategies.md) を参照。

---

## 📞 お問い合わせ

このドキュメントに関する質問や提案は、以下まで：

- GitHub Issues: [einja-inc/einja-management-template](https://github.com/einja-inc/einja-management-template/issues)
- 社内Slack: `#claude-code-dev`

---

## 📝 変更履歴

| 日付 | バージョン | 変更内容 |
|------|----------|---------|
| 2025-11-24 | 1.0.0 | 初版作成（戦略2推奨） |
| 2025-11-30 | 2.0.0 | 戦略4（SOT分離）を唯一の推奨案として採用 |
| 2025-11-30 | 2.1.0 | 実装計画の整合性修正（03削除、05新規作成） |

---

## ⚖️ ライセンス

このドキュメントは `einja-management-template` リポジトリのライセンスに従います。
