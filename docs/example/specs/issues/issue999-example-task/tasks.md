# 実装計画サンプル

このファイルは、タスク一覧の標準構造、フェーズ構成、タスク記述形式を示すサンプルです。

**📖 タスク階層の詳細は [タスク管理ガイドライン](../../../../steering/task-management.md) を参照**

## 概要

本ドキュメントは、サンプル機能の実装タスク一覧です。以下のユーザーストーリーを実装します：

- **Story 1**: ユーザー認証機能の実装（AC1.1-AC1.4）
- **Story 2**: プロフィール管理機能の実装（AC2.1-AC2.3）

**タスク階層構造:**
- Phase（フェーズ）: 1, 2...（単一の数字）
- タスクグループ: 1.1, 1.2...（チェックボックス付き、1-4時間）
- タスク: 1.1.1, 1.1.2...（チェックボックスなし、15-60分）
- サブタスク: タスクの下に箇条書き

---

## Phase 1: 認証・プロフィール管理基盤構築

### タスクグループ

- [ ] 1.1 ユーザー認証機能実装

#### タスク

1.1.1 データベーススキーマ設計と実装

**サブタスク**:
- Prisma schema.prismaにUserモデルを定義（id、email、name、createdAt、updatedAt）
- Sessionモデルを定義（id、userId、token、expiresAt）
- Accountモデルを定義（OAuth用、provider、providerAccountId）
- 適切なインデックスとリレーションを設定
- マイグレーションを作成（pnpm db:migrate:dev --name init）
- マイグレーションを実行し、データベースにテーブルを作成

**要件**: Story 1
**依存関係**: なし
**完了条件**: Prismaスキーマが定義され、マイグレーションが実行され、データベースにテーブルが作成されていること（AC1.1を満たす）
**対応設計**: design.md「データベース設計」セクション（L100-L150）
**シナリオテスト**: なし（DB設計のみ、UIフロー未実装のため）

1.1.2 認証ロジック実装

**サブタスク**:
- src/auth/magic-link.tsを作成
- generateMagicLink関数を実装（トークン生成、有効期限設定）
- verifyMagicLink関数を実装（トークン検証、セッション作成）
- メール送信サービスと連携
- エラーハンドリング実装（無効なトークン、期限切れ等）

**要件**: Story 1
**依存関係**: 1.1.1
**完了条件**: Magic Link認証ロジックが実装され、トークン生成・検証が正常に動作すること（AC1.2を満たす）
**対応設計**: design.md「認証ロジック」セクション（L200-L250）
**シナリオテスト**: なし（認証ロジックのみ、UIフロー未実装のため）

1.1.3 API Routes実装とテスト

**サブタスク**:
- app/api/auth/magic-link/route.tsを作成
- POST /api/auth/magic-linkハンドラーを実装（メールアドレス受付、Magic Link送信）
- app/api/auth/verify/route.tsを作成
- GET /api/auth/verifyハンドラーを実装（トークン検証、セッション作成、リダイレクト）
- zodバリデーションを適用
- エラーレスポンスを適切に返却
- E2Eテストファイルを作成（tests/e2e/auth.spec.ts）
- Magic Link送信テストケースを作成（有効なメールアドレス、無効なメールアドレス）
- トークン検証テストケースを作成（有効なトークン、無効なトークン、期限切れトークン）
- セッション作成テストケースを作成
- 全テストケースを実行

**要件**: Story 1
**依存関係**: 1.1.2
**完了条件**: 認証APIが実装され、Magic Link送信とトークン検証が正常に動作すること。Story 1の受け入れ基準AC1.1-AC1.3を満たすE2Eテストが通ること
**対応設計**: design.md「API設計」セクション（L300-L350）、「テスト戦略」E2Eテストセクション（L500-L550）
**シナリオテスト**: なし（API実装のみ、UIフロー未実装のため）

- [ ] 1.2 プロフィール管理機能実装

#### タスク

1.2.1 プロフィール用データベーススキーマ拡張

**サブタスク**:
- Prisma schema.prismaのUserモデルにbio、avatar、locationフィールドを追加
- マイグレーションを作成（pnpm db:migrate:dev --name add_profile_fields）
- マイグレーションを実行

**要件**: Story 2
**依存関係**: 1.1.1
**完了条件**: Userモデルにプロフィールフィールドが追加され、マイグレーションが完了していること（AC2.1を満たす）
**対応設計**: design.md「データベース設計」セクション（L160-L180）
**シナリオテスト**: なし（DBスキーマ拡張のみ、UIフロー未実装のため）

1.2.2 プロフィール更新API実装とテスト

**サブタスク**:
- app/api/users/me/route.tsを作成
- GET /api/users/meハンドラーを実装（認証確認、プロフィール取得）
- app/api/users/profile/route.tsを作成
- PUT /api/users/profileハンドラーを実装（認証確認、プロフィール更新）
- zodバリデーションを適用（bio最大500文字、location最大100文字等）
- エラーハンドリング実装
- E2Eテストファイルを作成（tests/e2e/profile.spec.ts）
- プロフィール取得テストケースを作成（認証済み、未認証）
- プロフィール更新テストケースを作成（有効なデータ、無効なデータ、認証なし）
- バリデーションテストケースを作成（bio文字数制限、location文字数制限）
- 全テストケースを実行

**要件**: Story 2
**依存関係**: 1.2.1
**完了条件**: プロフィールAPIが実装され、取得・更新が正常に動作すること。Story 2の受け入れ基準AC2.1-AC2.2を満たすE2Eテストが通ること
**対応設計**: design.md「API設計」セクション（L360-L400）、「テスト戦略」E2Eテストセクション（L560-L600）
**シナリオテスト**: シナリオ1 Step 1-3（部分実行：API認証まで）

---

## Phase 1完了確認

- [ ] 1.X フェーズ1完了条件確認

#### タスク

1.X.1 フェーズ1全タスク完了確認

**サブタスク**:
- タスクグループ1.1: ユーザー認証機能実装の全タスク完了確認（1.1.1-1.1.3）
- タスクグループ1.2: プロフィール管理機能実装の全タスク完了確認（1.2.1-1.2.2）
- 全シナリオテストの成功確認
- コードレビュー完了確認
- デプロイ可能な状態であることを確認

**要件**: Story 1, Story 2
**依存関係**: 1.1.3, 1.2.2
**完了条件**: フェーズ1の全タスクグループが完了し、受け入れ基準**AC1.1-AC1.3、AC2.1-AC2.2**を満たすこと。認証機能・プロフィール管理機能が正常動作し、全E2Eテストが成功、Biomeエラー0件を維持していること
**対応設計**: design.md 全セクション
**シナリオテスト**: シナリオ1 全Step（リグレッション確認）

---

## Phase 2: UI実装

### タスクグループ

- [ ] 2.1 認証UI実装

#### タスク

2.1.1 ログインページ実装とテスト

**サブタスク**:
- app/(auth)/login/page.tsxを作成
- メールアドレス入力フォームを実装（React Hook Form + zod）
- POST /api/auth/magic-link呼び出し処理を実装
- ローディング状態表示を実装
- エラーメッセージ表示を実装
- 成功メッセージ表示を実装（「メールを確認してください」等）
- E2Eテストでログインフロー検証
- アクセシビリティチェック

**要件**: Story 1
**依存関係**: Phase 1完了
**完了条件**: ログインページが実装され、Magic Link送信フォームが正常に動作すること（AC1.4を満たす）
**対応設計**: design.md「UI設計」セクション（L700-L750）
**シナリオテスト**: シナリオ1 全Step（フル実行）

---

## Phase 2完了確認

- [ ] 2.X フェーズ2完了条件確認

#### タスク

2.X.1 フェーズ2全タスク完了確認

**サブタスク**:
- タスクグループ2.1: 認証UI実装の全タスク完了確認（2.1.1）
- 全シナリオテストの成功確認
- UIコンポーネントのアクセシビリティ確認
- レスポンシブデザイン確認

**要件**: Story 1
**依存関係**: 2.1.1
**完了条件**: フェーズ2の全タスクグループが完了し、受け入れ基準**AC1.4**を満たすこと。認証UIが正常動作し、レスポンシブデザイン・アクセシビリティ基準を満たしていること
**対応設計**: design.md「UI設計」セクション
**シナリオテスト**: シナリオ1 全Step（リグレッション確認）

---

## 記述ルールのまとめ

### タスク階層（4階層）
- **Phase（フェーズ）**: 最上位単位（1, 2, 3...）
- **タスクグループ**: Vibe-KanbanタスクとPRの作成単位（1.1, 1.2...）、**チェックボックス付き**（`- [ ]`）、1-4時間
- **タスク**: 作業単位・コミット単位（1.1.1, 1.1.2...）、**チェックボックスなし**、15-60分
- **サブタスク**: タスク内の詳細作業項目、**箇条書き**（`-`）

### タスクグループの粒度
- 1つの受け入れ条件を満たす／1つの機能が動作する状態
- 1PR・1デプロイ・1QAテスト対象として適切な単位
- 実装工数の目安: 1-4時間

### タスクの粒度
- 具体的な作業項目
- 個別コミット単位
- 実装工数の目安: 15-60分

### メタデータ形式
- **サブタスク**: `**サブタスク**:` で始まる
- **要件**: `**要件**:` で始まる（例: `**要件**: Story 1`）
- **依存関係**: `**依存関係**:` で始まる（例: `**依存関係**: 1.1.1` または `**依存関係**: Phase 1完了`）
- **完了条件**: `**完了条件**:` で始まる。必ず受け入れ基準番号（AC形式）を含める（例: `**完了条件**: AC1.1を満たす`）
- **対応設計**: `**対応設計**:` で始まる（例: `**対応設計**: design.md「セクション名」`）
- **シナリオテスト**: `**シナリオテスト**:` で始まる（**全タスクに必須**、該当なければ「なし」と理由を明記）
  - 該当なし: `**シナリオテスト**: なし（DB設計のみ、UIフロー未実装のため）`
  - 部分実行: `**シナリオテスト**: シナリオ1 Step 1-3（部分実行：説明）`
  - フル実行: `**シナリオテスト**: シナリオ1 全Step（フル実行）`
  - リグレッション: `**シナリオテスト**: シナリオ1 全Step（リグレッション：説明）`

### フェーズ完了確認
- 各フェーズの最後に必ず配置
- 全タスクグループの完了を確認
- 完了条件に対応する全ての受け入れ基準番号（AC形式）を列挙
- 次フェーズ移行基準は完了条件に含めて記載
