---
description: ".claude/commands配下のコマンドを.cursor/commands用に自動変換"
---

# Cursor コマンド同期ツール

## あなたの役割

あなたは Claude Code のカスタムコマンドを Cursor 互換形式に自動変換する専門家です。`.claude/commands/` 配下の全コマンドファイルをスキャンし、Cursor で動作する形式に変換して `.cursor/commands/` に保存します。

## 処理フロー

### 1. ソースファイルのスキャン

**実行手順**:
```bash
# .claude/commands 配下の全 .md ファイルを検索
Glob: .claude/commands/*.md
```

各ファイルを Read で読み込み、変換対象として処理します。

**除外対象**:
以下のファイルは変換対象から除外します：
- `sync-cursor-commands.md`（このファイル自体。Claude Code専用機能のため）

### 2. 変換処理

各ファイルに対して以下の変換を実行します：

#### 2.1 サブエージェント参照の検出と変換

**検出パターン**:
以下のようなサブエージェント参照を検出します：
- 「Task ツールで {subagent_name} を呼び出す」
- 「{subagent_name} サブエージェントを使用」
- 「Task({subagent_type}: {subagent_name})」

**サブエージェントファイルパスの特定**:
`.claude/agents/` 配下を再帰的に検索し、`{サブエージェント名}.md` に一致するファイルを使用

例：
- `task-executer` → `.claude/agents/task/task-executer.md`
- `spec-requirements-generator` → `.claude/agents/specs/spec-requirements-generator.md`

**変換テンプレート**:

変換前（Claude Code 形式）の記述を、以下のテンプレートで置き換えます：

```markdown
{subagent_name} の処理を実行：

**📖 サブエージェントプロンプトの読み込み**
- `.claude/agents/` 配下から `{subagent_name}.md` を検索して Read ツールで読み込む
- YAML フロントマター（`---` で囲まれた部分）を除外
- 本文のプロンプト内容を取得

**🔨 プロンプトに従った処理の実行**
- 取得したプロンプト内容に記載された手順・指示に従って処理を実行
- プロンプト内の「自動探索・実行プロセス」セクションの手順を順次実行
- プロンプト内の「出力形式」セクションを確認

**📋 完了報告**
- サブエージェント定義ファイルの「出力形式」セクションに記載された形式で報告を出力
- 報告内容は構造化マークダウン（絵文字付き見出し使用）
```

#### 2.2 Cursor 用の注意書きを追加

ファイルの冒頭（YAML フロントマターの直後）に以下のセクションを追加：

```markdown
---
[既存のYAMLフロントマター]
---

> **⚠️ Cursor での動作について**
>
> このコマンドは `.claude/agents/` 配下のサブエージェント定義ファイルを参照します。
> サブエージェント呼び出し箇所では、該当する `.md` ファイルを Read で読み込み、
> そのプロンプト内容に従って処理を実行してください。
>
> **サブエージェント実行の手順**:
> 1. サブエージェント `.md` ファイルを Read で読み込む
> 2. YAML フロントマターを除外し、本文プロンプトを取得
> 3. プロンプトの指示に従って処理を実行
> 4. プロンプト内の「出力形式」に従った報告を生成

[既存のコマンド内容]
```

### 3. ファイルの出力

変換後のファイルを `.cursor/commands/` に Write します：

```bash
# 例
.claude/commands/task-exec.md → .cursor/commands/task-exec.md
.claude/commands/spec-create.md → .cursor/commands/spec-create.md
```

### 4. 変更サマリーの表示

処理完了後、以下の形式で報告を出力してください：

```markdown
## 🎉 Cursor コマンド同期完了

### 処理サマリー
- **変換元ディレクトリ**: `.claude/commands/`
- **変換先ディレクトリ**: `.cursor/commands/`
- **処理ファイル数**: N個

### 変換済みファイル一覧
1. ✅ spec-create.md
   - サブエージェント参照: 3箇所変換

2. ✅ task-exec.md
   - サブエージェント参照: 4箇所変換

3. ✅ start-dev.md
   - 変換不要（サブエージェント参照なし）

4. ✅ update-docs-by-task-specs.md
   - 変換不要（サブエージェント参照なし）

### 除外されたファイル
- ⏭️ sync-cursor-commands.md（Claude Code専用機能のため除外）

### 次のステップ
Cursor で以下のコマンドが利用可能になりました：
- `/spec-create`
- `/task-exec`
- `/start-dev`
- `/update-docs-by-task-specs`
```


## 変換時の注意事項

### 保持すべき内容
- YAML フロントマター（description など）
- コマンドの基本的なロジックと手順
- ユーザー向けの説明文
- 実行例とサンプルコード

### 変更すべき内容
- `Task` ツール呼び出し → サブエージェントファイル読み込み形式
- サブエージェント参照の説明
- Cursor 固有の注意書き追加

### 削除すべき内容
- Claude Code 固有のツール説明（Task ツールの使い方など）
- サブエージェント実行の内部実装詳細


## 使用例

```bash
# コマンド実行
/sync-cursor-commands

# 実行結果
✅ 4個のコマンドファイルを変換しました
- spec-create.md: 3箇所のサブエージェント参照を変換
- task-exec.md: 4箇所のサブエージェント参照を変換
- start-dev.md: 変換不要
- update-docs-by-task-specs.md: 変換不要
```

## エラー処理

以下のエラーに適切に対処してください：

1. **ソースファイルが存在しない**
   - `.claude/commands/` ディレクトリが空の場合
   - エラーメッセージを表示して終了

2. **サブエージェントファイルが見つからない**
   - 参照されているサブエージェントファイルが存在しない場合
   - 警告を表示し、該当箇所をスキップ

3. **書き込み権限エラー**
   - `.cursor/commands/` ディレクトリが書き込み不可の場合
   - エラーメッセージを表示して終了

## 拡張性

### 新しいサブエージェントの追加

将来的に新しいサブエージェントが追加された場合：

1. `.claude/agents/` 配下に新しいサブエージェントファイルを配置
2. 必要に応じてサブディレクトリで整理
3. このツールは自動的にファイルを検索して変換（設定変更不要）

### カスタマイズ

プロジェクト固有のニーズに応じて、以下をカスタマイズ可能：

- 変換テンプレートの形式
- 注意書きの内容
- エラーハンドリングの詳細度
